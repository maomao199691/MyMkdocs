
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.0, mkdocs-material-8.5.6" name="generator"/>
<title>数据质量 - 大数据成神之路</title>
<link href="../../../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="orange" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#_1">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="大数据成神之路" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="大数据成神之路">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            大数据成神之路
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              数据质量
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="orange" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue-grey" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/maomao199691/Python_Code.git" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    maomao199691/Python_Code
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="大数据成神之路" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="大数据成神之路">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    大数据成神之路
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/maomao199691/Python_Code.git" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    maomao199691/Python_Code
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Home" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          Home
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        大数据技术之高频面试题
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" id="__nav_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_1_2">
          项目涉及技术
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="项目涉及技术" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_2">
<span class="md-nav__icon md-icon"></span>
          项目涉及技术
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Linux%26Shell/">
        Linux&amp;Shell
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/JavaSE/">
        JavaSE
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Hadoop/">
        Hadoop
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Zookeeper/">
        Zookeeper
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Flume/">
        Flume
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Kafka/">
        Kafka
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Hive/">
        Hive
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Datax/">
        Datax
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Maxwell/">
        Maxwell
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/DolphinScheduler/">
        DolphinScheduler
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Scala/">
        Scala
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/SparkCore%26SQL/">
        Spark Core&amp;SQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/SparkStreaming/">
        Spark Streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C/">
        数据倾斜
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Flink/">
        Flink
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Flink%E5%AE%9E%E6%97%B6%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/">
        Flink实时项目优化
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/HBase/">
        HBase
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/ClickHouse/">
        ClickHouse
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Sqoop/">
        Sqoop
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Azkaban/">
        Azkaban
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84/">
        数仓架构
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%95%B0%E4%BB%93%E5%BB%BA%E6%A8%A1/">
        数仓建模
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E4%B8%9A%E5%8A%A1/">
        生产经验—业务
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E6%B5%8B%E8%AF%95%E4%B8%8A%E7%BA%BF%E7%9B%B8%E5%85%B3/">
        生产经验--测试上线相关
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E6%8A%80%E6%9C%AF/">
        生产经验—技术
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E7%83%AD%E7%82%B9%E9%97%AE%E9%A2%98/">
        生产经验—热点问题
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          数据质量
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        数据质量
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    概述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    数据质量标准分类
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    数据质量管理解决方案
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ods">
    ODS层数据校验
  </a>
<nav aria-label="ODS层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    数据校验通用脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ods_1">
    ODS层各表检验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dwd">
    DWD层数据校验
  </a>
<nav aria-label="DWD层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    数据校验通用脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dwd_1">
    DWD层各表检验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dws">
    DWS层数据校验
  </a>
<nav aria-label="DWS层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dws_1">
    DWS层数据质量校验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dws_2">
    DWS层数据校验脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dwt">
    DWT层数据校验
  </a>
<nav aria-label="DWT层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dwt_1">
    DWT层数据质量校验方法
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    宽表校验脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ads">
    ADS层数据校验
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93%E9%A1%B9%E7%9B%AE/">
        实时数仓项目
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../JavaSE/">
        JavaSE
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Redis/">
        Redis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../MySql/">
        MySql
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../JVM/">
        JVM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../JUC/">
        JUC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/">
        面试说明
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../LeetCode%E9%A2%98%E7%9B%AE%E7%B2%BE%E9%80%89/">
        LeetCode题目精选
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%89%8B%E5%86%99HQL%E9%A2%98%E7%9B%AE%E7%BB%83%E4%B9%A0/">
        手写HQL题目练习
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    概述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    数据质量标准分类
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    数据质量管理解决方案
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ods">
    ODS层数据校验
  </a>
<nav aria-label="ODS层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    数据校验通用脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ods_1">
    ODS层各表检验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dwd">
    DWD层数据校验
  </a>
<nav aria-label="DWD层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    数据校验通用脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dwd_1">
    DWD层各表检验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dws">
    DWS层数据校验
  </a>
<nav aria-label="DWS层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dws_1">
    DWS层数据质量校验
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dws_2">
    DWS层数据校验脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dwt">
    DWT层数据校验
  </a>
<nav aria-label="DWT层数据校验" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#dwt_1">
    DWT层数据质量校验方法
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    宽表校验脚本
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ads">
    ADS层数据校验
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/maomao199691/Python_Code.git/edit/master/docs/home/其他/数据质量管理.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg>
</a>
<h1 id="_1">数据质量</h1>
<h2 id="_2">概述</h2>
<p>数据质量的高低代表了该数据满足数据消费者期望的程度，这种程度基于他们对数据的使用预期，只有达到数据的使用预期才能给予管理层正确的决策参考。数据质量管理作为数据仓库的一个重要模块，主要可以分为数据的健康标准量化、监控和保障。</p>
<h2 id="_3">数据质量标准分类</h2>
<p>① 数据完整性: 数据不存在大量的缺失值、不缺少某一日期/部门/地点等部分维度的数据，同时在ETL过程当中应保证数据的完整不丢失。验证数据时总数应符合正常规律时间推移，记录数总数的增长符合正常的趋势。</p>
<p>② 数据一致性: 数仓各层的数据，应与上一层保持数据一致，最终经过数据清洗转化（ETL）的宽表/指标能和数据源保持一致。</p>
<h2 id="_4">数据质量管理解决方案</h2>
<p>本文通过Shell命令和Hive脚本的方式，通过验证增量数据的记录数、全表空值记录数、全表记录数是否在合理的范围之内，以及验证数据来源表和目标表一致性，确定当日的数据是否符合健康标准，达到数据质量的监控与管理。</p>
<h2 id="ods"><strong>ODS层数据校验</strong></h2>
<h3 id="_5">数据校验通用脚本</h3>
<p>通过shell脚本调用hive，检验当日分区增加的记录数量和全表记录数量是否在合理的范围之内，同时检验关键字段为空的记录的记录数量。</p>
<p>1）创建数据检查脚本文件夹，用于存放数据校验shell脚本</p>
<pre><code class="language-java">[atguigu@hadoop102 module]$ mkdir -p data_check/sh
[atguigu@ hadoop102 sh]$ pwd
/opt/module/data_check/sh
</code></pre>
<p>2）在Hive中创建表数据质量校验记录表，记录数据校验的各个指标：</p>
<pre><code>[atguigu@atguigu data_check]$ hive
</code></pre>
<p>创建数据库，用于存放数据质量校验的结果数据：</p>
<pre><code>hive (default)&gt; create database datacheck;
</code></pre>
<p>创建数据表，用于存放ods层的数据检验结果：</p>
<pre><code class="language-java">hive (datacheck)&gt; create table datacheck.table_count_add_standard(
    data_date string comment '数据时间分区dt',
    database_name string comment '库名',
table_name string comment '表名',
table_type string comment '表类型（全量/增量）',
    add_count bigint comment '当日增量数据的记录数',
null_count bigint comment '表空值记录数',
total_count bigint comment '全表记录数'
);
hive (datacheck)&gt;quit;
</code></pre>
<p>3）在路径/opt/module/data_check/sh下创建数据检验增量表通用shell脚本</p>
<pre><code>[atguigu@hadoop102 sh]$ vim increment_data_check_public.sh
</code></pre>
<p>在脚本中编写如下内容：</p>
<pre><code class="language-java">#!/bin/bash
# 增量数据所在的日期分区
do_date=$1
# 校验数据的表名
table_name=$2
# 需要校验空值的列名，以逗号’,’隔开
null_column=$3
# 初始化SQL查询语句
null_where_sql_str=''
# 将空值检验字符串切成列名数组
array=(${null_column//,/ })
# 遍历数组，拼接空值查询条件
for(( i=0;i&lt;${#array[@]};i++)) do
   if [ $i -eq 0 ];then
        null_where_sql_str=" where ${array[i]} is null "
   else
        null_where_sql_str="$null_where_sql_str or ${array[i]} is null "
   fi
done;
# 执行当日增量数据记录数量SQL查询语句
add_count_query_result=`hive -e "select count(*) from gmall.$table_name where dt='$do_date'"`
# 取出当日增量数据记录数量
add_count=${add_count_query_result:3}
# 执行当日全表数据记录数量SQL查询语句
total_count_query_result=`hive -e "select count(*) from gmall.$table_name"`
# 取出当日全量数据记录数量
total_count=${total_count_query_result:3}
# 执行全表空值数据记录数量SQL查询语句
table_null_query_result=`hive -e "select count(*) from gmall.$table_name $null_where_sql_str"`
# 取出全表空值数据记录数量
null_count=${table_null_query_result:3}
# 将所有数据检验结果插入到表中
hive -e "insert into datacheck.table_count_add_standard values('$do_date','gmall','$table_name','increment_table',$add_count,$null_count,'$total_count')"
</code></pre>
<p>脚本参数注释：</p>
<p>第一个参数：传入时间分区参数( dt )</p>
<p>第二个参数：需要进行数据校验的表名( table_name )</p>
<p>第三个参数：需要判断是否为空值的字段名称用逗号‘ ，’隔开，例如：col1,col2,col3</p>
<p>给脚本/opt/module/data_check/sh/increment_data_check_public.sh赋权限：</p>
<pre><code>[atguigu@hadoop102 sh]$ chmod 777 increment_data_check_public.sh
</code></pre>
<p>脚本执行示例：</p>
<pre><code>[atguigu@hadoop102 sh]$ 
./increment_data_check_public.sh 2020-06-14 ods_activity_rule id,activity_id
</code></pre>
<p>4）在路径/opt/module/data_check/sh下创建数据检验全量表通用shell脚本</p>
<pre><code>[atguigu@hadoop102 sh]$ vim total_data_check_public.sh
</code></pre>
<p>在脚本中编写如下内容：</p>
<pre><code class="language-java">#!/bin/bash
# 增量数据所在的日期分区
do_date=$1
# 校验数据的表名
table_name=$2
# 需要校验空值的列名，以逗号’,’隔开
null_column=$3
# 将空值检验字符串切成列名数组
null_where_sql_str=''
# 遍历数组，拼接空值查询条件
array=(${null_column//,/ })
# 遍历数组，拼接空值查询条件
for(( i=0;i&lt;${#array[@]};i++)) do
   if [ $i -eq 0 ];then
        null_where_sql_str=" where ${array[i]} is null "
   else
        null_where_sql_str="$null_where_sql_str or ${array[i]} is null "
   fi
done;
# 执行当日全表数据记录数量SQL查询语句table_count_query_result=`hive -e "select count(*) from gmall.$table_name"`
# 取出当日全量数据记录数量
table_count=${table_count_query_result:3}
# 执行全表空值数据记录数量SQL查询语句
table_null_query_result=`hive -e "select count(*) from gmall.$table_name $null_where_sql_str"`
# 取出全表空值数据记录数量
null_count=${table_null_query_result:3}
# 将所有数据检验结果插入到表中
hive -e "insert into datacheck.table_count_add_standard values('$do_date','gmall','$table_name','total_table',null,$null_count,'$table_count')"
</code></pre>
<p>脚本参数注释：</p>
<p>第一个参数：传入数据校验日期( dt )</p>
<p>第二个参数：需要进行数据校验的表名( table_name )</p>
<p>第三个参数：需要判断是否为空值的字段名称用逗号’ , ‘隔开，例如：col1,col2,col3</p>
<p>给脚本/opt/module/data_check/sh/total_data_check_public.sh赋权限：</p>
<pre><code>[atguigu@hadoop102 sh]$ chmod 777 total_data_check_public.sh
</code></pre>
<p>脚本执行示例：</p>
<pre><code>[atguigu@hadoop102 sh]$ ./total_data_check_public.sh 2020-06-14 ods_activity_rule id,activity_id
</code></pre>
<h2 id="ods_1">ODS层各表检验</h2>
<p>\1. 涉及表</p>
<p>增量检查</p>
<p>（1）订单详情表（ods_order_detail）</p>
<p>（2）用户表（ods_user_info）</p>
<p>（3）支付流水表（ods_payment_info）</p>
<p>（4）订单状态表（ods_order_status_log）</p>
<p>（5）商品评论表（ods_comment_info）</p>
<p>（6）退单表（ods_order_refund_info）</p>
<p>（7）活动订单关联表（ods_activity_order）</p>
<p>全量检查</p>
<p>（1）订单表（ods_order_info）</p>
<p>（2）SKU商品表（ods_sku_info）</p>
<p>（3）商品一级分类表（ods_base_category1）</p>
<p>（4）商品二级分类表（ods_base_category2）</p>
<p>（5）商品三级分类表（ods_base_category3）</p>
<p>（6）品牌表（ods_base_trademark）</p>
<p>（7）SPU商品表（ods_spu_info）</p>
<p>（8）加购表（ods_cart_info）</p>
<p>（9）商品收藏表（ods_favor_info）</p>
<p>（10）优惠券领用表（ods_coupon_use）</p>
<p>（11）优惠券表（ods_coupon_info）</p>
<p>（12）活动表（ods_activity_info）</p>
<p>（13）优惠规则表（ods_activity_rule）</p>
<p>（14）编码字典表（ods_base_dic）</p>
<ol>
<li>ODS层数据检查脚本</li>
</ol>
<p>​        1）在路径/opt/module/data_check/sh下创建ODS层数据检查脚本</p>
<pre><code>[atguigu@atguigu sh]$ pwd
/opt/module/data_check/sh
[atguigu@atguigu sh]$ vim ods_data_check.sh
</code></pre>
<p>在脚本中编写如下内容：</p>
<pre><code>#!/bin/bash
data_date=$1

# 增量检查
# 订单详情表
/opt/module/data_check/sh/increment_data_check_public.sh $data_date ods_order_detail id,order_id,user_id,sku_id,sku_name,order_price,sku_num,create_time
# 用户表
/opt/module/data_check/sh/increment_data_check_public.sh $data_date ods_user_info id,name,birthday,gender,email,user_level,create_time,operate_time
# 支付流水表
/opt/module/data_check/sh/increment_data_check_public.sh $data_date ods_payment_info id,out_trade_no,order_id,user_id,alipay_trade_no,total_amount,subject,payment_type,payment_time
# 订单状态表
/opt/module/data_check/sh/increment_data_check_public.sh $data_date ods_order_status_log id,order_id,order_status,operate_time
# 商品评论表
/opt/module/data_check/sh/increment_data_check_public.sh $data_date ods_comment_info id,user_id,sku_id,spu_id,order_id,appraise,create_time
# 退单表
/opt/module/data_check/sh/increment_data_check_public.sh $data_date ods_order_refund_info id,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_time
# 活动订单关联表
/opt/module/data_check/sh/increment_data_check_public.sh $data_date ods_activity_order id,activity_id,order_id,create_time
# 全量检查
# 订单表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_order_info id,final_total_amount,order_status,user_id,out_trade_no,create_time,operate_time,province_id,benefit_reduce_amount,original_total_amount,feight_fee
# SKU商品表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_sku_info id,spu_id,price,sku_name,sku_desc,weight,tm_id,category3_id,create_time
# 商品一级分类表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_base_category1 id,name
# 商品二级分类表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_base_category2 id,name,category1_id
# 商品三级分类表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_base_category3 id,name,category2_id
# 品牌表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_base_trademark tm_id,tm_name
# SPU商品表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_spu_info id,spu_name,category3_id,tm_id
# 加购表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_cart_info id,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_time
# 商品收藏表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_favor_info id,user_id,sku_id,spu_id,is_cancel,create_time,cancel_time
# 优惠券领用表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_coupon_use id,coupon_id,user_id,order_id,coupon_status,get_time,using_time,used_time
# 优惠券表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_coupon_info id,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_time
# 活动表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_activity_info id,activity_name,activity_type,start_time,end_time,create_time
# 优惠规则表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_activity_rule id,activity_id,condition_amount,condition_num,benefit_amount,benefit_discount,benefit_level
# 编码字典表
/opt/module/data_check/sh/total_data_check_public.sh $data_date ods_base_dic dic_code,dic_name,parent_code,create_time,operate_time
</code></pre>
<p>2）给脚本/opt/module/data_check/sh/ods_data_check.sh赋权限：</p>
<pre><code>[atguigu@atguigu sh]$ chmod 777 ods_data_check.sh
</code></pre>
<h2 id="dwd">DWD层数据校验</h2>
<h3 id="_6">数据校验通用脚本</h3>
<p>1）创建数据表，用于存放dwd层的数据检验结果：</p>
<pre><code>hive (datacheck)&gt; create table datacheck.dwd_table_data_check(
    data_date string comment '数据时间分区dt',
    database_name string comment '库名',
    source_table_name string comment '数据源表表名',
    source_column string comment '数据源表字段名',
    target_table_name string comment '数据目标表表名',
    target_column string comment '数据目标表字段名',
    consistent_data_count bigint comment '全表数据一致记录数',
    source_table_count bigint comment '数据源表全表记录数',
    target_table_count bigint comment '数据目标表全表记录数'
);
hive (datacheck)&gt;quit;
</code></pre>
<p>2）在路径/opt/module/data_check/sh下创建dwd层数据一致性检验通用shell脚本</p>
<pre><code>[atguigu@hadoop102 sh]$ vim table_consistent_check_public.sh
</code></pre>
<p>在脚本中编写如下内容：</p>
<pre><code class="language-java">#!/bin/bash
# 增量数据所在的日期分区
do_date=$1
# 校验数据源表的表名
source_table_name=$2
# 检验数据源表的字段（与目标表顺序一致才能对比两个字段）
source_column=$3
# 检验数据目标表的表名
target_table_name=$4
# 检验数据目标表的字段（与源表顺序一致才能对比两个字段）
target_column=$5

# 初始化SQL查询语句
join_on_sql_str=''
# 将检验数据源表的字段切成列名数组
source_column_array=(${source_column//,/ })
# 将检验数据目标表的字段切成列名数组
target_column_array=(${target_column//,/ })

# 遍历数组，拼接表关联条件，输入字段全部关联
for(( i=0;i&lt;${#source_column_array[@]};i++)) do
   if [ $i -eq 0 ];then
        join_on_sql_str=" on $source_table_name.${source_column_array[i]}=$target_table_name.${target_column_array[i]} "
   else
        join_on_sql_str="$join_on_sql_str and $source_table_name.${source_column_array[i]}=$target_table_name.${target_column_array[i]} "
   fi
done;

echo "-------------ods-dwd  一致性检查-------------"
# 执行数据源表和目标表关联查询SQL语句，查询数据一致的条数
consistent_data_query_result=`hive -e "select count(*) from gmall.$source_table_name join gmall.$target_table_name $join_on_sql_str"`
# 取出全表查询数据一致的条数
consistent_data_count=${consistent_data_query_result:3}

echo "---------------ods层记录条数-----------------"
# 执行查询数据源表的记录条数
source_table_query_result=`hive -e "select count(*) from gmall.$source_table_name"`
# 取出全表数据源表的记录条数
source_table_count=${source_table_query_result:3}

echo "---------------dwd层记录条数-----------------"
# 执行查询数据目标表的记录条数
target_table_query_result=`hive -e "select count(*) from gmall.$target_table_name"`
# 取出全表数据目标表的记录条数
target_table_count=${target_table_query_result:3}

# 将所有数据检验结果插入到表中
hive -e "insert into datacheck.dwd_table_data_check values('$do_date','gmall','$source_table_name','$source_column','$target_table_name','$target_column','$consistent_data_count','$source_table_count','$target_table_count')"
</code></pre>
<p>脚本参数注释：</p>
<p>第1个参数：传入时间分区参数( dt )</p>
<p>第2个参数：需要进行数据校验源表的表名(source_table_name )</p>
<p>第3个参数：需要校验的数据源表字段名称用逗号‘ ，’隔开，例如：col1,col2,col3</p>
<p>第4个参数：需要进行数据校验目标表的表名(target_table_name )</p>
<p>第5个参数：需要校验的数据目标表字段名称用逗号‘ ，’隔开，例如：col1,col2,col3</p>
<p>给脚本/opt/module/data_check/sh/increment_data_check_public.sh赋权限：</p>
<pre><code>[atguigu@hadoop102 sh]$ chmod 777 table_consistent_check_public.sh
</code></pre>
<p>脚本执行示例：</p>
<pre><code>[atguigu@hadoop102 sh]$ ./table_consistent_check_public.sh 2020-06-14 ods_base_province name dwd_dim_base_province province_name
</code></pre>
<h2 id="dwd_1">DWD层各表检验</h2>
<p>\1. 业务数据表数据检验</p>
<p>①   优惠券信息表</p>
<pre><code class="language-java">数据源表：ods_coupon_info
源表字段：id,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_time
数据目标表：dwd_dim_coupon_info
目标表字段：id,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_time
分区：dt='2020-06-14'
</code></pre>
<p>数据检查脚本：</p>
<pre><code class="language-java">[atguigu@hadoop102 sh]$ pwd
/opt/module/data_check/sh
[atguigu@hadoop102 sh]$ /opt/module/data_check/sh/table_consistent_check_public.sh 2020-06-14 ods_coupon_info id,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_time dwd_dim_coupon_info id,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_time
</code></pre>
<p>①  订单明细事实表</p>
<pre><code>数据源表：ods_order_detail
源表字段：id,order_id,user_id,sku_id,sku_name,order_price,sku_num,create_time
数据目标表：dwd_fact_order_detail
目标表字段：id,order_id,user_id,sku_id,sku_name,order_price,sku_num,create_time
分区：dt='2020-06-14'
</code></pre>
<p>数据检查脚本：</p>
<pre><code>[atguigu@hadoop102 sh]$ pwd
/opt/module/data_check/sh
[atguigu@hadoop102 sh]$ /opt/module/data_check/sh/table_consistent_check_public.sh 2020-06-14 ods_order_detail id,order_id,user_id,sku_id,sku_name,order_price,sku_num,create_time dwd_fact_order_detail id,order_id,user_id,sku_id,sku_name,order_price,sku_num,create_time
</code></pre>
<p>①  支付事实表</p>
<pre><code>数据源表：ods_payment_info
源表字段：id,out_trade_no,order_id,user_id,alipay_trade_no,total_amount,subject,payment_type,payment_time
数据目标表：dwd_fact_payment_info
目标表字段：id,out_trade_no,order_id,user_id,alipay_trade_no,payment_amount,subject,payment_type,payment_time
分区：dt='2020-06-14'
</code></pre>
<p>数据检查脚本：</p>
<pre><code>[atguigu@hadoop102 sh]$ pwd
/opt/module/data_check/sh
[atguigu@hadoop102 sh]$ /opt/module/data_check/sh/table_consistent_check_public.sh 2020-06-14 ods_payment_info id,out_trade_no,order_id,user_id,alipay_trade_no,total_amount,subject,payment_type,payment_time dwd_fact_payment_info id,out_trade_no,order_id,user_id,alipay_trade_no,payment_amount,subject,payment_type,payment_time
</code></pre>
<p>①  退款事实表</p>
<pre><code>数据源表：ods_order_refund_info
源表字段：id,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_time
数据目标表：dwd_fact_order_refund_info
目标表字段：id,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_time
分区：dt='2020-06-14'
</code></pre>
<p>数据检查脚本：</p>
<pre><code>[atguigu@hadoop102 sh]$ pwd
/opt/module/data_check/sh
[atguigu@hadoop102 sh]$ /opt/module/data_check/sh/table_consistent_check_public.sh 2020-06-14 ods_order_refund_info id,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_time dwd_fact_order_refund_info id,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_time
</code></pre>
<p>①  评价事实表</p>
<pre><code>数据源表：ods_comment_info
源表字段：id,user_id,sku_id,spu_id,order_id,appraise,create_time
数据目标表：dwd_fact_comment_info
目标表字段：id,user_id,sku_id,spu_id,order_id,appraise,create_time
分区：dt='2020-06-14'
</code></pre>
<p>数据检查脚本：</p>
<pre><code>[atguigu@hadoop102 sh]$ pwd
/opt/module/data_check/sh
[atguigu@hadoop102 sh]$ /opt/module/data_check/sh/table_consistent_check_public.sh 2020-06-14 ods_comment_info id,user_id,sku_id,spu_id,order_id,appraise,create_time dwd_fact_comment_info id,user_id,sku_id,spu_id,order_id,appraise,create_time
</code></pre>
<p>①  加购事实表</p>
<pre><code>数据源表：ods_cart_info
源表字段：id,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_time
数据目标表：dwd_fact_cart_info
目标表字段：id,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_time
分区：dt='2020-06-14'
</code></pre>
<p>数据检查脚本：</p>
<pre><code>[atguigu@hadoop102 sh]$ pwd
/opt/module/data_check/sh
[atguigu@hadoop102 sh]$ /opt/module/data_check/sh/table_consistent_check_public.sh 2020-06-14 ods_cart_info id,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_time dwd_fact_cart_info id,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_time
</code></pre>
<p>①  收藏事实表</p>
<pre><code>数据源表：ods_favor_info
源表字段：id,user_id,sku_id,spu_id,is_cancel,create_time,cancel_time
数据目标表：dwd_fact_favor_info
目标表字段：id,user_id,sku_id,spu_id,is_cancel,create_time,cancel_time
分区：dt='2020-06-14'
</code></pre>
<p>数据检查脚本：</p>
<pre><code>[atguigu@hadoop102 sh]$ pwd
/opt/module/data_check/sh
[atguigu@hadoop102 sh]$ /opt/module/data_check/sh/table_consistent_check_public.sh 2020-06-14 ods_favor_info id,user_id,sku_id,spu_id,is_cancel,create_time,cancel_time dwd_fact_favor_info id,user_id,sku_id,spu_id,is_cancel,create_time,cancel_time
</code></pre>
<ol>
<li>DWD层数据检查脚本</li>
</ol>
<p>1）在路径/opt/module/data_check/sh下创建dwd层数据一致性检验shell脚本</p>
<p><code>[atguigu@hadoop102 sh]$ vim dwd_data_check.sh</code></p>
<p>2）在脚本中编写如下内容：</p>
<p>```
   #!/bin/bash
   # 数据所在的日期分区
   do_date=$1</p>
<p>/opt/module/data_check/sh/table_consistent_check_public.sh $do_date ods_coupon_info id,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_time dwd_dim_coupon_info id,coupon_name,coupon_type,condition_amount,condition_num,activity_id,benefit_amount,benefit_discount,create_time,range_type,spu_id,tm_id,category3_id,limit_num,operate_time,expire_time</p>
<p>/opt/module/data_check/sh/table_consistent_check_public.sh $do_date ods_order_detail id,order_id,user_id,sku_id,sku_name,order_price,sku_num,create_time dwd_fact_order_detail id,order_id,user_id,sku_id,sku_name,order_price,sku_num,create_time</p>
<p>/opt/module/data_check/sh/table_consistent_check_public.sh $do_date ods_payment_info id,out_trade_no,order_id,user_id,alipay_trade_no,total_amount,subject,payment_type,payment_time dwd_fact_payment_info id,out_trade_no,order_id,user_id,alipay_trade_no,payment_amount,subject,payment_type,payment_time</p>
<p>/opt/module/data_check/sh/table_consistent_check_public.sh $do_date ods_order_refund_info id,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_time dwd_fact_order_refund_info id,user_id,order_id,sku_id,refund_type,refund_num,refund_amount,refund_reason_type,create_time</p>
<p>/opt/module/data_check/sh/table_consistent_check_public.sh $do_date ods_comment_info id,user_id,sku_id,spu_id,order_id,appraise,create_time dwd_fact_comment_info id,user_id,sku_id,spu_id,order_id,appraise,create_time</p>
<p>/opt/module/data_check/sh/table_consistent_check_public.sh $do_date ods_cart_info id,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_time dwd_fact_cart_info id,user_id,sku_id,cart_price,sku_num,sku_name,create_time,operate_time,is_ordered,order_time</p>
<p>/opt/module/data_check/sh/table_consistent_check_public.sh $do_date ods_favor_info id,user_id,sku_id,spu_id,is_cancel,create_time,cancel_time dwd_fact_favor_info id,user_id,sku_id,spu_id,is_cancel,create_time,cancel_time
   ```</p>
<p>脚本参数注释：</p>
<p>第1个参数：传入时间分区参数( dt )</p>
<p>3）给脚本/opt/module/data_check/sh/dwd_data_check.sh赋权限：</p>
<p><code>[atguigu@hadoop102 sh]$ chmod 777 dwd_data_check.sh</code></p>
<p>脚本执行示例：</p>
<p><code>[atguigu@hadoop102 sh]$ ./dwd_data_check.sh 2020-06-15</code></p>
<h2 id="dws">DWS层数据校验</h2>
<h3 id="dws_1">DWS层数据质量校验</h3>
<p>由于DWS层数据质量无法从一致性进行判断，只能通过表记录数以及空值记录数等维度判断， 所以在DWS将检验当日宽表记录数量是否在合理的范围之内，同时检验关键字段为空的记录的记录数量。</p>
<h3 id="dws_2">DWS层数据校验脚本</h3>
<p><strong>1.</strong> <strong>数据校验涉及表</strong></p>
<p>​                 每日会员行为</p>
<p>​                 每日商品行为</p>
<p>​                 每日活动行为</p>
<p>​                 每日地区行为</p>
<p><strong>2.数据质量校验脚本</strong></p>
<p>​        1）在路径/opt/module/data_check/sh下创建ODS层数据检查脚本</p>
<pre><code>[atguigu@atguigu sh]$ pwd
/opt/module/data_check/sh
[atguigu@atguigu sh]$ vim dws_data_check.sh
</code></pre>
<p>在脚本中编写如下内容：</p>
<pre><code>#!/bin/bash
data_date=$1

# 每日会员行为
/opt/module/data_check/sh/total_data_check_public.sh $data_date dws_user_action_daycount user_id,login_count,cart_count,order_count

# 每日商品行为
/opt/module/data_check/sh/total_data_check_public.sh $data_date dws_sku_action_daycount sku_id,order_count,order_num,order_amount,payment_count,payment_num,payment_amount,refund_count

# 每日活动行为
/opt/module/data_check/sh/total_data_check_public.sh $data_date dws_activity_info_daycount id,activity_name,activity_type,start_time,end_time,create_time,display_count

# 每日地区统计
/opt/module/data_check/sh/total_data_check_public.sh $data_date dws_area_stats_daycount id,province_name,area_code,iso_code,region_id,region_name,login_count,order_count,order_amount,payment_count,payment_amount
</code></pre>
<p>2）给脚本/opt/module/data_check/sh/dws_data_check.sh赋权限：</p>
<pre><code>[atguigu@atguigu sh]$ chmod 777 dws_data_check.sh
</code></pre>
<p>3）执行/opt/module/data_check/sh/dws_data_check.sh，检验2020-06-14当日宽表数据质量。</p>
<pre><code>[atguigu@atguigu sh]$ ./dws_data_check.sh 2020-16-14
</code></pre>
<h2 id="dwt">DWT层数据校验</h2>
<h3 id="dwt_1">DWT层数据质量校验方法</h3>
<p>在宽表阶段数据已经经过了一定的判断、过滤和变换等操作，因此在DWT层也将检验当日宽表记录数量是否在合理的范围之内，同时检验关键字段为空的记录的记录数量。</p>
<h3 id="_7">宽表校验脚本</h3>
<p>​        <strong>1.</strong> <strong>数据校验涉及表</strong></p>
<p>​                 设备主题宽表</p>
<p>​                 会员主题宽表</p>
<p>​                 商品主题宽表</p>
<p>活动主题宽表</p>
<p>地区主题宽表</p>
<p>​        <strong>2.数据质量校验脚本</strong></p>
<p>​        1）在路径/opt/module/data_check/sh下创建ODS层数据检查脚本</p>
<pre><code>[atguigu@atguigu sh]$ pwd
/opt/module/data_check/sh
[atguigu@atguigu sh]$ vim dwt_data_check.sh
</code></pre>
<p>在脚本中编写如下内容：</p>
<pre><code>#!/bin/bash
data_date=$1

# 全量检查
# 设备主题宽表
/opt/module/data_check/sh/total_data_check_public.sh $data_date dwt_uv_topic mid_id,brand,model,login_date_first,login_date_last,login_day_count,login_count

# 会员主题宽表
/opt/module/data_check/sh/total_data_check_public.sh $data_date dwt_user_topic user_id,login_date_first,login_date_last,login_count,login_last_30d_count,order_date_first,order_date_last,order_count,order_amount,order_last_30d_count,order_last_30d_amount,payment_date_first,payment_date_last,payment_count,payment_amount,payment_last_30d_count,payment_last_30d_amount

# 商品主题宽表
/opt/module/data_check/sh/total_data_check_public.sh $data_date dwt_sku_topic sku_id,spu_id,order_last_30d_count,order_last_30d_num,order_last_30d_amount,order_count,order_num,order_amount

# 活动主题宽表
/opt/module/data_check/sh/total_data_check_public.sh $data_date dwt_activity_topic id,activity_name,activity_type,start_time,end_time,create_time,display_day_count,order_day_count,order_day_amount,payment_day_count,payment_day_amount,display_count,order_count,order_amount,payment_count,payment_amount

# 地区主题宽表
/opt/module/data_check/sh/total_data_check_public.sh $data_date id,province_name,area_code,iso_code,region_id,region_name,login_day_count,login_last_30d_count,order_day_count,order_day_amount,order_last_30d_count,order_last_30d_amount,payment_day_count,payment_day_amount,payment_last_30d_count,payment_last_30d_amount
</code></pre>
<p>2）给脚本/opt/module/data_check/sh/dwt_data_check.sh赋权限：</p>
<pre><code>[atguigu@atguigu sh]$ chmod 777 dwt_data_check.sh
</code></pre>
<p>3）执行/opt/module/data_check/sh/dwt_data_check.sh，检验2020-06-15当日宽表数据质量。</p>
<pre><code>[atguigu@atguigu sh]$ ./dwt_data_check.sh 2020-16-15
</code></pre>
<h2 id="ads">ADS层数据校验</h2>
<p>数据仓库中ADS层数据是经过高度聚合计算的具体指标，因此无法从技术层面进行判断数据是否健康。需要通过校对对各个指标的数值是否在合理的范围之内进行校验，进行定制化数据校验。由于ADS层涉及的需求无法一一涉及，因此在这针对一个需求进行分析。</p>
<p>1）在Hive中创建表数据质量校验记录表，记录数据校验的各个指标：</p>
<pre><code>[atguigu@atguigu data_check]$ hive
</code></pre>
<p>创建数据库，用于存放数据质量校验的结果数据：</p>
<pre><code>hive (default)&gt; create database datacheck;
</code></pre>
<p>创建数据表，用于存放ods层的数据检验结果：</p>
<pre><code>hive (datacheck)&gt; create table datacheck.ads_table_data_check(
    data_date string comment '数据时间分区dt',
    database_name string comment '库名',
table_name string comment '表名',
column_name string comment '指标名',
    healthy_value string comment '该指标合理值',
now_value bigint comment '该指标当前值',
is_healthy bigint comment '该指标是否合理：1合理/0不合理'
);
hive (datacheck)&gt;quit;
</code></pre>
<p>3）在路径/opt/module/data_check/sh下创建数据检验增量表通用shell脚本</p>
<pre><code>[atguigu@hadoop102 sh]$ vim ads_data_check.sh
</code></pre>
<p>在脚本中编写如下内容：</p>
<pre><code>#!/bin/bash
# 增量数据所在的日期分区
do_date=$1

hive -e "insert into datacheck.ads_table_data_check select 
    temp.data_date,
    temp.database_name,
    temp.table_name,
    temp.column_name,
    temp.healthy_value,
    temp.new_mid_count,
    temp.is_healthy
from (
    select 
        "$do_date" as data_date,
        "gmall" as database_name,
        "ads_new_mid_count" as table_name,
        "new_mid_count" as column_name,
        "大于3" as healthy_value,
        new_mid_count,
        if(new_mid_count&gt;3,1,0) as is_healthy
    from gmall.ads_new_mid_count
) as temp
"
</code></pre>
<p>脚本参数注释：</p>
<p>第一个参数：传入时间分区参数( dt )</p>
<p>给脚本/opt/module/data_check/sh/ads_data_check.sh赋权限：</p>
<pre><code>[atguigu@hadoop102 sh]$ chmod 777 ads_data_check.sh
</code></pre>
<p>脚本执行示例：</p>
<pre><code>[atguigu@hadoop102 sh]$ 
./ads_data_check.sh 2020-06-14
</code></pre>
<script async="" crossorigin="anonymous" data-category="General" data-category-id="DIC_kwDOILD1rs4CR4oA" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="maomao199691/discuss" data-repo-id="R_kgDOILD1rg" data-strict="0" data-theme="light" src="https://giscus.app/client.js">
</script>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: 生产经验—热点问题" class="md-footer__link md-footer__link--prev" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E7%83%AD%E7%82%B9%E9%97%AE%E9%A2%98/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              生产经验—热点问题
            </div>
</div>
</a>
<a aria-label="Next: 实时数仓项目" class="md-footer__link md-footer__link--next" href="../%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93%E9%A1%B9%E7%9B%AE/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              实时数仓项目
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2016 - 2020 Martin Donath
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://twitter.com/squidfunk" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.078830c0.min.js"></script>
<script src="../../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body>
</html>