
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.0, mkdocs-material-8.5.6" name="generator"/>
<title>手写HQL题目练习 - 大数据成神之路</title>
<link href="../../../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="orange" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#hql">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="大数据成神之路" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="大数据成神之路">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            大数据成神之路
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              手写HQL题目练习
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="orange" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue-grey" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="black" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/maomao199691/Python_Code.git" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    maomao199691/Python_Code
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="大数据成神之路" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="大数据成神之路">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    大数据成神之路
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/maomao199691/Python_Code.git" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    maomao199691/Python_Code
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1">
          Home
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Home" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          Home
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        大数据技术之高频面试题
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_2" id="__nav_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_1_2">
          项目涉及技术
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="项目涉及技术" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_2">
<span class="md-nav__icon md-icon"></span>
          项目涉及技术
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Linux%26Shell/">
        Linux&amp;Shell
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/JavaSE/">
        JavaSE
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Hadoop/">
        Hadoop
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Zookeeper/">
        Zookeeper
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Flume/">
        Flume
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Kafka/">
        Kafka
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Hive/">
        Hive
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Datax/">
        Datax
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Maxwell/">
        Maxwell
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/DolphinScheduler/">
        DolphinScheduler
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Scala/">
        Scala
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/SparkCore%26SQL/">
        Spark Core&amp;SQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/SparkStreaming/">
        Spark Streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C/">
        数据倾斜
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Flink/">
        Flink
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Flink%E5%AE%9E%E6%97%B6%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/">
        Flink实时项目优化
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/HBase/">
        HBase
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/ClickHouse/">
        ClickHouse
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Sqoop/">
        Sqoop
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../%E9%A1%B9%E7%9B%AE%E6%B6%89%E5%8F%8A%E6%8A%80%E6%9C%AF/Azkaban/">
        Azkaban
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E9%A1%B9%E7%9B%AE%E6%9E%B6%E6%9E%84/">
        数仓架构
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%95%B0%E4%BB%93%E5%BB%BA%E6%A8%A1/">
        数仓建模
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E4%B8%9A%E5%8A%A1/">
        生产经验—业务
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E6%B5%8B%E8%AF%95%E4%B8%8A%E7%BA%BF%E7%9B%B8%E5%85%B3/">
        生产经验--测试上线相关
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E6%8A%80%E6%9C%AF/">
        生产经验—技术
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E7%94%9F%E4%BA%A7%E7%BB%8F%E9%AA%8C%E2%80%94%E7%83%AD%E7%82%B9%E9%97%AE%E9%A2%98/">
        生产经验—热点问题
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E6%95%B0%E6%8D%AE%E8%B4%A8%E9%87%8F%E7%AE%A1%E7%90%86/">
        数据质量
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93%E9%A1%B9%E7%9B%AE/">
        实时数仓项目
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../JavaSE/">
        JavaSE
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../Redis/">
        Redis
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../MySql/">
        MySql
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../JVM/">
        JVM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../JUC/">
        JUC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../%E9%9D%A2%E8%AF%95%E8%AF%B4%E6%98%8E/">
        面试说明
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../LeetCode%E9%A2%98%E7%9B%AE%E7%B2%BE%E9%80%89/">
        LeetCode题目精选
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          手写HQL题目练习
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        手写HQL题目练习
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1">
    第1题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2">
    第2题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3">
    第3题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4">
    第4题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5">
    第5题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6">
    第6题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7">
    第7题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8">
    第8题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9">
    第9题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10">
    第10题
  </a>
<nav aria-label="第10题" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1_1">
    第1个小题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2_1">
    第2个小题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3_1">
    第3个小题
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11">
    第11题
  </a>
<nav aria-label="第11题" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1_2">
    第1小题
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1">
    第1题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2">
    第2题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3">
    第3题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4">
    第4题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5">
    第5题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6">
    第6题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7">
    第7题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8">
    第8题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#9">
    第9题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#10">
    第10题
  </a>
<nav aria-label="第10题" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1_1">
    第1个小题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2_1">
    第2个小题
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3_1">
    第3个小题
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#11">
    第11题
  </a>
<nav aria-label="第11题" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1_2">
    第1小题
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/maomao199691/Python_Code.git/edit/master/docs/home/其他/手写HQL题目练习.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg>
</a>
<h1 id="hql">手写HQL题目练习</h1>
<h2 id="1">第1题</h2>
<p><strong>1.</strong> <strong>表结构：</strong>表名：score_info   字段：uid、subject_id,score</p>
<p><strong>2.</strong> <strong>需求：</strong>找出所有科目成绩都大于某一学科平均成绩的学生</p>
<p><strong>3.</strong> <strong>数据准备：</strong></p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/score_info.txt
1001    01  90
1001    02  90
1001    03  90
1002    01  85
1002    02  85
1002    03  70
1003    01  70
1003    02  70
1003    03  85
</code></pre>
<ol>
<li>建表语句</li>
</ol>
<pre><code>hive(default)&gt; 
create table score_info(
    uid string,          -- 学生id
    subject_id string, -- 课程id
    score int            -- 课程分数
)
row format delimited fields terminated by '\t';
</code></pre>
<p>\5. 思路：</p>
<p>① 求出每个学科平均成绩</p>
<p>② 根据是否大于平均成绩记录标记flag，大于标记为0，否则标记为1</p>
<p>③ 根据学生id进行分组统计flag的和，和为0的则是所有学科都大于平均成绩</p>
<p>④ 编写最终sql</p>
<pre><code>select
    t2.uid
from(
    select
        t1.uid,
        if(t1.score&gt;t1.avg_score,0,1) flag
    from(
        select
            uid,
            score,
            avg(score) over(partition by subject_id) avg_score
        from score_info
    )t1
)t2
group by uid
having sum(t2.flag)=0;
</code></pre>
<p>结果：</p>
<pre><code>OK
t2.uid 
1001  
</code></pre>
<h2 id="2">第2题</h2>
<p><strong>1.</strong> <strong>数据结构：</strong>某平台的用户访问数据</p>
<p>表名：action</p>
<p>字段：userId，visitDate，visitCount</p>
<p><strong>2.</strong> <strong>需求：</strong>要求使用SQL统计出每个用户的月累计访问次数及累计访问次数（注意日期数据的格式是否能解析），</p>
<p><strong>3.</strong> <strong>数据准备:</strong></p>
<p>用户访问数据</p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/action.txt
u01 2017/1/21   5
u02 2017/1/23   6
u03 2017/1/22   8
u04 2017/1/20   3
u01 2017/1/23   6
u01 2017/2/21   8
u02 2017/1/23   6
u01 2017/2/22   4
</code></pre>
<ol>
<li>建表语句</li>
</ol>
<pre><code>hive(default)&gt; 
create table action(
    userId string,    -- 用户id
    visitDate string, -- 访问日期
    visitCount int     -- 访问次数
) 
row format delimited fields terminated by "\t";
</code></pre>
<p>\5. 思路：</p>
<p>① 修改数据格式，将日期中的"/"转换成"-"</p>
<p>② 计算每人单月访问量</p>
<p>③ 按月累计访问量</p>
<p>④ 最终SQL</p>
<pre><code>select
    userId,
    mn,
    mn_count,
    sum(mn_count) over(partition by userId order by mn) 
from( 
    select
        userId,
        mn,
        sum(visitCount) mn_count
    from(
        select
             userId,
             date_format(regexp_replace(visitDate,'/','-'),'yyyy-MM') mn,
             visitCount
        from action
    )t1
    group by userId,mn
)t2;
</code></pre>
<p>结果：</p>
<pre><code>OK
t2.userid       t2.mn   t2.sum_month    sum_acc
u01     2017-01 11      11
u01     2017-02 12      23
u02     2017-01 12      12
u03     2017-01 8       8
u04     2017-01 3       3 
</code></pre>
<h2 id="3">第3题</h2>
<p><strong>1.</strong> <strong>背景：</strong></p>
<p>有50W个京东店铺，每个顾客访客访问任何一个店铺的任何一个商品时，都会产生一个访问日志，访问日志存储的表名</p>
<p><strong>2.</strong> <strong>表名：</strong>visit</p>
<p><strong>字段名：</strong>user_id,shop</p>
<p><strong>3.</strong> <strong>需求:</strong></p>
<p>① 创建表</p>
<p>② 每个店铺的UV（访客数）</p>
<p>③ 每个店铺访问次数top3的访客信息。输出店铺名称、访客id、访问次数</p>
<p><strong>4.数据集</strong></p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/visit.txt
u1  a
u2  b
u1  b
u1  a
u3  c
u4  b
u1  a
u2  c
u5  b
u4  b
u6  c
u2  c
u1  b
u2  a
u2  a
u3  a
u5  a
u5  a
u5  a
</code></pre>
<p>\5. 答案：</p>
<p>① 建表语句</p>
<pre><code>hive(default)&gt;
create table visit(
    user_id string,
    shop string
) 
row format delimited fields terminated by '\t';
</code></pre>
<p>② 每个店铺UV（访客数）</p>
<pre><code>hive(default)&gt;
select 
    shop,
    count(distinct user_id) uv
from visit 
group by shop;
</code></pre>
<p>结果</p>
<pre><code>OK
shop    uv
a       4
b       4
c       3
</code></pre>
<p>③ 每个店铺访问次数top3的访客信息。输出店铺名称、访客id、访问次数</p>
<p>思路：</p>
<p>·查询每个店铺被每个用户访问次数</p>
<p>·计算每个店铺被用户访问次数排名</p>
<p>·取每个店铺排名前3的</p>
<p>·最终SQL</p>
<pre><code>hive(default)&gt;
select
    t2.shop,
    t2.user_id,
    t2.user_num
from (
     select
         t1.shop,
         t1.user_id,
         t1.user_num,
         rank() over(partition by t1.shop order by t1.user_num desc ) rk
     from (
              select
                  shop,
                  user_id,
                  count(user_id) user_num
              from visit
              group by shop,user_id
    ) t1
) t2
where t2.rk &lt;=3;
</code></pre>
<h2 id="4">第4题</h2>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>表名：order_tab   字段名：dt（下单日期）、order_id（订单编号）、user_id（用户ID）、amount（成交金额）</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>① 创建表</p>
<p>② 给出 2017年每个月的订单数、用户数、总成交金额。</p>
<p>③ 给出2017年11月的新客数（指在11月才有第一笔订单）</p>
<p><strong>3.</strong> <strong>数据准备</strong></p>
<p>编辑文件：order_tab.txt</p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/order_tab.txt
2017-01-01,10029028,1000003251,33.57
2017-01-02,10029029,1000003251,20.57
2017-02-01,10029030,1000003251,40.57
2017-02-02,10029031,1000003252,60.57
2017-02-03,10029032,1000003252,60.57
2017-11-03,10029033,1000003253,70.57
2017-11-03,10029034,1000003253,80.57
</code></pre>
<p><strong>4.答案：</strong></p>
<p>① 建表语句</p>
<pre><code>hive(default)&gt; 
create table order_tab(
    dt string,          -- 下单日期
    order_id string,    -- 订单id
    user_id string,     -- 用户id
    amount decimal(10,2)-- 订单金额
) 
row format delimited fields terminated by ',';
</code></pre>
<p>② 给出 2017年每个月的订单数、用户数、总成交金额。</p>
<pre><code>hive(default)&gt;
select
    date_format(dt,'yyyy-MM') mn,
    count(order_id) order_num,
    count(distinct user_id) user_num,
    sum(amount) sum_amount
from order_tab
where year(dt) = '2017'
group by date_format(dt,'yyyy-MM');
</code></pre>
<p>结果：</p>
<pre><code>OK
mn      order_num       user_num        sum_amount
2017-01 2       1       54.14
2017-02 3       2       161.71
2017-11 2       1       151.14
</code></pre>
<p>2）给出2017年11月的新客数（指在11月才有第一笔订单）</p>
<pre><code>hive(default)&gt;
select
    user_id,
    count(distinct user_id) user_num
from order_tab
group by user_id
having date_format(min(dt),'yyyy-MM')='2017-11';
</code></pre>
<p>结果：</p>
<pre><code>OK
user_id         user_num
1000003253      1
</code></pre>
<h2 id="5">第5题</h2>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>表名：user_age</p>
<p>字段名：dt（访问日期）、user_id（用户ID）、age（用户年龄）</p>
<p><strong>2.</strong> <strong>需求：</strong>统计所有用户和活跃用户的总数及平均年龄</p>
<p><strong>活跃用户：</strong>指连续两天都有访问记录的用户</p>
<p><strong>3.</strong> <strong>数据集：</strong></p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/user_age.txt
2019-02-11,user_1,23
2019-02-11,user_2,19
2019-02-11,user_3,39
2019-02-11,user_1,23
2019-02-11,user_3,39
2019-02-11,user_1,23
2019-02-12,user_2,19
2019-02-13,user_1,23
2019-02-15,user_2,19
2019-02-16,user_2,19
</code></pre>
<ol>
<li>建表语句：</li>
</ol>
<pre><code>hive(default)&gt;
create table user_age(
    dt string,      -- 日期
    user_id string, -- 用户
    age int         -- 年龄
)
row format delimited fields terminated by ',';
</code></pre>
<p>\5. 思路：</p>
<p>① 按照日期以及用户分组，按照日期排序并给出排名</p>
<p>② 计算日期及排名的差值</p>
<p>③ 过滤出差值大于等于2的，即为连续两天活跃的用户</p>
<p>④ 对数据进行去重处理（一个用户可以在两个不同的时间地点连续登录）</p>
<p>⑤ 计算活跃用户（两天连续有访问）的人数以及平均年龄</p>
<p>⑦ 对全量数据集进行按照用户去重</p>
<p>⑧ 计算所有用户的数量以及平均年龄</p>
<p>⑨ 将第⑤步和第⑦步的结果进行union all操作</p>
<p>⑩.求和</p>
<p>最终代码：</p>
<pre><code>hive(default)&gt;
select 
    sum(user_total_count),
    sum(user_total_avg_age),
    sum(twice_count),
    sum(twice_count_avg_age)
from (
    select
        0 user_total_count,
        0 user_total_avg_age,
        count(*) twice_count,
        cast(sum(age)/count(*) as decimal(10,2)) twice_count_avg_age
    from(
        select
           user_id,
           min(age) age
        from(
            select
               user_id,
               min(age) age
            from(
                select
                    user_id,
                    age,
                    date_sub(dt,rk) flag
                from(
                    select
                       dt,
                       user_id,
                       min(age) age,
                       rank() over(partition by user_id order by dt) rk
                    from user_age
                    group by dt,user_id
                )t1
            )t2
            group by user_id,flag
            having count(*)&gt;=2
        )t3
        group by user_id 
    )t4

    union all

    select
       count(*) user_total_count,
       cast((sum(age)/count(*)) as decimal(10,1)),
       0 twice_count,
       0 twice_count_avg_age
    from(
        select
            user_id,
            min(age) age 
        from user_age 
        group by user_id
    )t5
)t6;
</code></pre>
<p>另一种算法：</p>
<pre><code>hive(default)&gt;
select
    sum(t3.user_num_all) user_num_all,
    sum(t3.avg_age_all) avg_age_all,
    sum(t3.user_num_active) user_num_active,
    sum(t3.avg_age_active) avg_age_active
from (
         select
             count(t1.user_id) user_num_all,
             cast((sum(t1.min_age) / count(t1.user_id)) as decimal(4,2)) avg_age_all,
             0 user_num_active,
             0 avg_age_active
         from (
                  select
                      user_id,
                      min(age) min_age
                  from user_age
                  group by user_id
         ) t1
         union
         select
             0 user_num_all,
             0 avg_age_all,
             count(t2.user_id) user_num_active,
             cast((sum(t2.age)/count(t2.user_id)) as decimal(4,2)) avg_age_active
         from (
                  select
                      distinct t1.user_id,
                               age
                  from (
                           select
                               user_id,
                               datediff(dt,lag(dt,1,'1900-01-01') over(partition by user_id order by dt )) date_diff,
                               age
                           from user_age
                       ) t1
                  where t1.date_diff=1
         ) t2
) t3;
</code></pre>
<h2 id="6">第6题</h2>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p><strong>表名：</strong>ordertable</p>
<p><strong>字段名：</strong>userid（用户ID）、money（金额）、paymenttime（支付时间戳）paymentdate（支付日期）、orderid（订单ID）</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>① 仅使用paymenttime字段，统计所有用户在今年(2022年)10月份第一次购买商品的金额</p>
<p>② 仅使用paymentdate字段，统计所有用户在今年(2022年)10月份第一次购买商品的金额</p>
<p><strong>3.</strong> <strong>数据集：</strong>编辑文件：odertable.txt</p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/odertable.txt
1001    100 1633609057000   2021-10-07  1111111111
1002    110 1636287457000   2021-11-07  2222222222
1003    120 1667823457000   2022-11-07  3333333333
1004    130 1665145057000   2022-10-07  4444444444
1005    140 1666613857000   2022-10-24  5555555555
1005    150 1665577057000   2022-10-12  6666666666
1004    160 1660306657000   2022-08-12  7777777777
1003    170 1665749857000   2022-10-14  8888888888
1005    180 1665922657000   2022-10-16  9999999999
</code></pre>
<ol>
<li>建表语句：</li>
</ol>
<pre><code>hive(default)&gt;
create table ordertable(
    userid string,      -- 购买用户    
    money int,          -- 金额
    paymenttime string, -- 支付时间戳
    paymentdate string,
    orderid string      -- 订单id
)
row format delimited fields terminated by '\t';
</code></pre>
<ol>
<li>使用paymenttime字段的答案</li>
</ol>
<pre><code>hive(default)&gt;
select
    t2.userid,
    t2.money,
    t2.orderid
from (
         select
             t1.userid,
             t1.money,
             t1.mnd,
             t1.orderid,
             rank() over(partition by userid order by t1.mnd) rk
         from (
                  select
                      userid,
                      money,
                      from_unixtime(cast(paymenttime *0.001 as bigint) ,'yyyy-MM') mn,
                      from_unixtime(cast(paymenttime *0.001 as bigint) ,'yyyy-MM-dd') mnd,
                      orderid
                  from ordertable
              ) t1
         where t1.mn='2022-10'
) t2
where t2.rk=1;
</code></pre>
<p>结果</p>
<pre><code>OK
t2.userid       t2.money        t2.orderid
1003    170     8888888888
1004    130     4444444444
1005    150     6666666666
</code></pre>
<ol>
<li>使用paymentdate字段的答案</li>
</ol>
<pre><code>hive(default)&gt;
select
    t1.userid,
    t1.paymentdate,
    od.money
from
    (select
         userid,
         min(paymentdate) paymentdate
     from
         ordertable
     where
             date_format(paymentdate,'yyyy-MM')='2022-10'
     group by
         userid)t1
        join
    ordertable od
    on
                t1.userid=od.userid
            and
                t1.paymentdate=od.paymentdate;
</code></pre>
<p>结果：</p>
<pre><code>OK
t1.userid       t1.paymentdate  od.money
1003    2022-10-14      170
1004    2022-10-07      130
1005    2022-10-12      150
</code></pre>
<h2 id="7">第7题</h2>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>有一个线上服务器访问日志，数据结构如下：</p>
<p>表名：ip_info</p>
<p>字段名：time1（访问时间）、interface（访问接口）、ip（访问的IP地址）</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>① 建表语句</p>
<p>② 求11月9号下午14点（14-15点），访问/api/user/login接口次数的top2的ip地址</p>
<p><strong>3.</strong> <strong>数据集：</strong></p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/ip_info.txt
2016-11-09 14:22:05 /api/user/login 110.23.5.33
2016-11-09 11:23:10 /api/user/detail    57.3.2.16
2016-11-09 14:59:40 /api/user/login 200.6.5.166
2016-11-09 14:22:05 /api/user/login 110.23.5.34
2016-11-09 14:22:05 /api/user/login 110.23.5.34
2016-11-09 14:22:05 /api/user/login 110.23.5.34
2016-11-09 11:23:10 /api/user/detail    57.3.2.16
2016-11-09 23:59:40 /api/user/login 200.6.5.166
2016-11-09 14:22:05 /api/user/login 110.23.5.34
2016-11-09 11:23:10 /api/user/detail    57.3.2.16
2016-11-09 23:59:40 /api/user/login 200.6.5.166
2016-11-09 14:22:05 /api/user/login 110.23.5.35
2016-11-09 14:23:10 /api/user/detail    57.3.2.16
2016-11-09 23:59:40 /api/user/login 200.6.5.166
2016-11-09 14:59:40 /api/user/login 200.6.5.166
2016-11-09 14:59:40 /api/user/login 200.6.5.166
</code></pre>
<ol>
<li>建表语句：</li>
</ol>
<pre><code>hive(default)&gt;
create table ip_info(
    time1 string,       -- 访问时间
    interface string,   -- 访问接口
    ip string           -- 访问的ip地址
)
row format delimited fields terminated by '\t';
</code></pre>
<p>\5. 思路：</p>
<p>① 过滤符合要求的数据</p>
<p>② 对数据进行分组统计，分组字段ip，统计记录个数</p>
<p>③ 按照每个ip的统计记录个数排序，取前2个。</p>
<p>\6. 最终SQL</p>
<pre><code>hive(default)&gt;
select
    ip, interface, count(ip) ip_times
from ip_info
where date_format(time1,"yyyy-MM-dd HH") &gt;= "2016-11-09 14"
  and date_format(time1,"yyyy-MM-dd HH") &lt;= "2016-11-09 15"
  and interface ="/api/user/login"
group by ip, interface
order by ip_times desc
limit 2;
</code></pre>
<h2 id="8">第8题</h2>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>有一个账号表，</p>
<p>表名：account</p>
<p>字段名：dist_id（区组id）、account（账号）、gold（金币）</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>① 建表语句</p>
<p>② 查询各自区组的money排名前3的账号（分组取前3）</p>
<p>\3. 数据集：</p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/account.txt
1003    11133   23000
1001    11113   43000
1003    11134   41000
1002    11123   33000
1003    11135   31001
1002    11121   22000
1002    11122   31000
1001    11114   21000
1001    11115   11001
1001    11111   25500
1001    11112   34300
1002    11124   11700
1002    11125   23501
1003    11131   45800
1003    11132   14900
1003    11133   23400
1001    11113   43200
1003    11134   41700
1002    11123   33800
1003    11135   31901
1002    11121   22100
1002    11122   31200
1001    11114   21400
1001    11115   11101
</code></pre>
<ol>
<li>建表语句：</li>
</ol>
<pre><code>hive(default)&gt;
CREATE TABLE `account`
(
    `dist_id` int,    -- '区组id'
    `account` string, -- '账号'
    `gold`    string -- '金币'
)
row format delimited fields terminated by '\t';
</code></pre>
<p>\5. 思路：</p>
<p>\6. 最终sql</p>
<pre><code>hive(default)&gt;
select
    t1.account
from (
         select
             dist_id,
             account,
             gold,
             rank() over(partition by dist_id order by gold desc ) rk
         from account
         ) t1
where t1.rk &lt;=3;
输出结果
t1.account
11123
11113
11112
11123
11123
11122
11131
11134
11134 
</code></pre>
<h2 id="9">第9题</h2>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>① 会员表：member  字段名：memberid、credits（积分）</p>
<p>② 销售表：sale    字段名：memberid、MNAccount（购买金额）</p>
<p>③ 退货表：regoods 字段名：memberid、RMNAccount（退货金额）</p>
<p><strong>2.</strong> <strong>业务说明：</strong></p>
<p>（1）销售表中的销售记录可以是会员购买，也可以是非会员购买。（即销售表中的memberid可以为空）；</p>
<p>（2）销售表中的一个会员可以有多条购买记录；</p>
<p>（3）退货表中的退货记录可以是会员，也可是非会员；</p>
<p>（4）一个会员可以有一条或多条退货记录。</p>
<p><strong>3.</strong> <strong>需求：</strong></p>
<p>① 建表语句</p>
<p>② 分组查出销售表中所有会员购买金额，同时分组查出退货表中所有会员的退货金额，把会员id相同的购买金额-退款金额得到的结果更新到表会员表中对应会员的积分字段（credits保留两位小数）</p>
<p><strong>4.</strong> <strong>数据集</strong></p>
<pre><code>[atguigu@hadoop102~]$ vim /opt/module/hive/datas/sale.txt
1001    50.3
1002    56.5
1003    235
1001    23.6
1005    56.2
        25.6
        33.5
[atguigu@hadoop102~]$ vim /opt/module/hive/datas/regoods.txt
1001    20.1
1002    23.6
1001    10.1
        23.5
        10.2
1005    0.8
</code></pre>
<p><strong>5.</strong> <strong>建表语句：</strong></p>
<pre><code>// member会员表
hive(default)&gt;
create table member(
    memberid string,
    credits decimal(10,2)
) 
row format delimited fields terminated by '\t';

// sale销售表
hive(default)&gt;
create table sale(
    memberid string,
    MNAccount double
) 
row format delimited fields terminated by '\t;

// regoods退货表
hive(default)&gt;
create table regoods(
    memberid string,
    RMNAccount double
) 
row format delimited fields terminated by '\t';
</code></pre>
<ol>
<li>最终sql</li>
</ol>
<pre><code>hive(default)&gt;
insert into table member
select
    t1.memberid,
    MNAccount-RMNAccount
from
    (select
        memberid,
        sum(MNAccount) MNAccount
    from
        sale
    where
        memberid!=''
    group by
        memberid
    )t1
join
    (select
        memberid,
        sum(RMNAccount) RMNAccount
    from
        regoods
    where
        memberid!=''
    group by
        memberid
    )t2
on
    t1.memberid=t2.memberid;
</code></pre>
<h2 id="10">第10题</h2>
<h3 id="1_1">第1个小题</h3>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>表名：stu_subject</p>
<p>字段名：name、kecheng、fenshu</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>① 建表语句</p>
<p>② 统计出每门课都大于80分的学生姓名</p>
<p><strong>3.</strong> <strong>数据集：</strong></p>
<pre><code>[atguigu@hadoop102~]$ vim /opt/module/hive/datas/stu_subject.txt
张三,语文,81
张三,数学,75
李四,语文,76
李四,数学,90
王五,语文,81
王五,数学,100
王五,英语,90
</code></pre>
<p>\4. 答案：</p>
<p>① 建表语句</p>
<pre><code>hive(default)&gt;
create table stu_subject(
       name string,
       kecheng string,
       fenshu  int
)
row format delimited fields terminated by ',';
</code></pre>
<p>① </p>
<pre><code>hive(default)&gt;
select 
distinct name 
from stu_subject
where name not in (
            select 
                distinct name 
            from stu_subject
            where fenshu&lt;=80
);
</code></pre>
<p>② </p>
<pre><code>hive(default)&gt;
select 
name 
from stu_subject
group by name 
having min(fenshu)&gt;80;
</code></pre>
<h3 id="2_1">第2个小题</h3>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>表名： student（学生表）</p>
<p>字段名：id、stu_id、name、subject_id、subject_name、score</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>① 建表语句</p>
<p>② 删除除了id不同其他都相同的学生冗余信息</p>
<p>\4. 数据准备：</p>
<p>编辑文件student.txt</p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/student.txt
1001    1234    张三  11  数学  80
1002    1234    张三  11  数学  80
1003    1235    张21 12  语文  90
1004    1235    张21 13  英语  8
1005    1235    张21 11  数学  70
1006    1234    张三  12  语文  80
1007    1234    张三  11  数学  90
1008    1234    张三  13  英语  80
1009    1236    张22 11  数学  80
1010    1234    张22 12  语文  80
</code></pre>
<p>\3. 答案</p>
<p>① 建表语句</p>
<pre><code>hive(default)&gt;
// 创建中件表
create table student(
    id  int,
    stu_id string,
    name string,
    subject_id int,
    subject_name  string,
    score string
)
row format delimited fields terminated by '\t';
// 创建支持事务的表
create table student1(
    id  int,
    stu_id string,
    name string,
    subject_id int,
    subject_name  string,
    score string
)
row format delimited fields terminated by '\t'
stored as orc
    TBLPROPERTIES ("transactional"="true");
</code></pre>
<p>② 删除除了id不同其他都相同的学生冗余信息(切换事务管理器等配置)</p>
<pre><code>hive(default)&gt; set hive.support.concurrency=true;
hive(default)&gt; set hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;
hive(default)&gt;
delete from student
where id not in(
        select 
            min(id)
        from student
        group by stu_id, name,subject_id,subject_name,score
);
</code></pre>
<h3 id="3_1">第3个小题</h3>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>表名：team</p>
<p>字段名：name</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>一个叫team的表，里面只有一个字段name,一共有4条纪录，分别是a,b,c,d,对应四个球队，现在四个球队进行比赛，用一条sql语句显示所有可能的比赛组合。</p>
<p>\3. 数据准备</p>
<p>编辑文件team.txt</p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/team.txt
a
b
c
d
</code></pre>
<p><strong>3.</strong> <strong>最终SQL</strong></p>
<pre><code>hive(default)&gt;
select 
     a.name,
     b.name
from team a, team b
where a.name &lt; b.name;
</code></pre>
<h2 id="11">第11题</h2>
<h3 id="1_2">第1小题</h3>
<p><strong>1.</strong> <strong>数据结构：</strong></p>
<p>​      表名：order，</p>
<p>​      字段名：order_id(订单ID)，user_id（用户ID），amount（金额），pay_datetime（付费时间）,channel_id（渠道ID）,dt（分区字段）。</p>
<p><strong>2.</strong> <strong>需求：</strong></p>
<p>① 在hive中创建分区表，并导入数据；</p>
<p>② 查询dt=’2018-09-01’里每个渠道的订单数，下单人数(去重),总金额；</p>
<p>③ 查询dt=’2018-09-01’里每个渠道的金额最大3笔订单；</p>
<p>④ 有一天发现订单数据重复，请分析原因；</p>
<p><strong>3.数据准备</strong></p>
<p>编辑文件order.txt</p>
<pre><code>[atguigu@hadoop102 ~]$ vim /opt/module/hive/datas/order.txt
11111   1001    3400    2018-09-01 23:30:22 01
22222   1001    2500    2018-09-01 23:30:29 02
33333   1002    3200    2018-09-02 22:12:12 02
44444   1002    3400    2018-09-01 23:30:22 01
55555   1003    2500    2018-11-11 13:23:29 01
66666   1004    3200    2018-04-02 12:12:12 02
11122   1001    3400    2018-09-01 23:30:22 02
22233   1001    2500    2018-11-21 23:30:29 01
33344   1002    3200    2018-10-12 22:12:12 02
44455   1002    3400    2018-12-09 23:30:22 01
55566   1003    2500    2018-09-01 13:23:29 02
66677   1004    3200    2018-07-13 12:12:12 02
</code></pre>
<p><strong>4.</strong> <strong>答案：</strong></p>
<p>① 在hive中创建order表；</p>
<pre><code>hive(default)&gt;
create table `order`(
     order_id int,
     user_id int,
     amount double,
     pay_datatime string,
     channel_id int
)partitioned by(dt string)
row format delimited fields terminated by '\t';
</code></pre>
<p>在hive中创建中间表order_tmp</p>
<pre><code>hive(default)&gt;
create table order_tmp(
      order_id int,
      user_id int,
      amount double,
      pay_datatime timestamp,
      channel_id int
)
row format delimited fields terminated by '\t';
</code></pre>
<p>向中间表加载数据</p>
<pre><code>hive(default)&gt; load data local inpath "/opt/module/hive/datas/order.txt" into table order_tmp;
</code></pre>
<p>通过中间表向分区表order中插入数据</p>
<pre><code>hive(default)&gt; insert into table `order` select order_id,user_id,amount,pay_datatime,channel_id, date_format(pay_datatime,'yyyy-MM-dd') from order_tmp;
</code></pre>
<p>② 查询dt=’2018-09-01’里每个渠道的订单数，下单人数(去重),总金额；</p>
<pre><code>hive(default)&gt;
select
    channel_id,
    count(order_id) channel_order_num,
    count(distinct user_id) channel_user_num,
    sum(amount) channel_amount_sum
from `order`
where dt='2018-09-01'
group by channel_id;
结果：
OK
channel_id      channel_order_num       channel_user_num        channel_amount_sum
1       2       2       6800.0
2       3       2       8400.0
Time taken: 22.712 seconds, Fetched: 2 row(s)
</code></pre>
<p>③ 查询dt=’2018-09-01’里每个渠道的金额最大3笔订单；</p>
<pre><code>hive(default)&gt;
select
    t1.channel_id,
    t1.order_id,
    t1.amount
from (
         select
             channel_id,
             order_id,
             amount,
             rank() over(partition by channel_id order by amount desc ) rk
         from `order`
         where dt='2018-09-01'
) t1
where t1.rk&lt;=3;
结果：
OK
t1.channel_id   t1.order_id     t1.amount
1                  11111            3400.0
1                  44444            3400.0
2                  11122            3400.0
2                  22222            2500.0
2                  55566            2500.0
Time taken: 1.395 seconds, Fetched: 5 row(s)
</code></pre>
<p>④ 有一天发现订单数据重复，请分析原因；</p>
<p><strong>分析：</strong></p>
<p>订单属于业务数据，在关系型数据库中不会存在数据重复</p>
<p>hive建表时也不会导致数据重复，</p>
<p>我推测是在数据迁移时，迁移失败导致重复迁移数据冗余了</p>
<script async="" crossorigin="anonymous" data-category="General" data-category-id="DIC_kwDOILD1rs4CR4oA" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="maomao199691/discuss" data-repo-id="R_kgDOILD1rg" data-strict="0" data-theme="light" src="https://giscus.app/client.js">
</script>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: LeetCode题目精选" class="md-footer__link md-footer__link--prev" href="../LeetCode%E9%A2%98%E7%9B%AE%E7%B2%BE%E9%80%89/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              LeetCode题目精选
            </div>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2016 - 2020 Martin Donath
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://twitter.com/squidfunk" rel="noopener" target="_blank" title="twitter.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.078830c0.min.js"></script>
<script src="../../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body>
</html>